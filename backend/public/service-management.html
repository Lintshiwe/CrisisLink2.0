<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CrisisLink Service Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <script>
      // Suppress Tailwind CDN warning in development
      if (typeof window !== 'undefined') {
        const originalWarn = console.warn
        console.warn = function (...args) {
          const message = args[0] && args[0].toString ? args[0].toString() : ''
          if (
            message.includes('cdn.tailwindcss.com') ||
            message.includes('should not be used in production')
          ) {
            return // Suppress Tailwind warnings
          }
          originalWarn.apply(console, args)
        }
      }
    </script>

    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

      body {
        font-family: 'Inter', sans-serif;
        background: linear-gradient(
          135deg,
          #0f172a 0%,
          #1e293b 50%,
          #334155 100%
        );
        min-height: 100vh;
      }

      .glass-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .service-card {
        transition: all 0.3s ease;
      }

      .service-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      }

      .status-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
      }

      .status-online {
        background-color: #10b981;
        box-shadow: 0 0 6px #10b981;
      }

      .status-offline {
        background-color: #ef4444;
        box-shadow: 0 0 6px #ef4444;
      }

      .status-warning {
        background-color: #f59e0b;
        box-shadow: 0 0 6px #f59e0b;
      }
    </style>
  </head>
  <body class="text-gray-100">
    <!-- Navigation Header -->
    <nav
      class="bg-slate-800/80 backdrop-blur-sm border-b border-slate-700 sticky top-0 z-50"
    >
      <div class="max-w-7xl mx-auto px-6 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-4">
            <i class="fas fa-cogs text-2xl text-blue-400"></i>
            <h1 class="text-xl font-bold">CrisisLink Service Management</h1>
          </div>
          <div class="flex items-center space-x-4">
            <button
              id="refreshBtn"
              class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors"
            >
              <i class="fas fa-sync-alt mr-2"></i>Refresh
            </button>
            <a
              href="/agent-dashboard.html"
              class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg transition-colors"
            >
              <i class="fas fa-dashboard mr-2"></i>Dashboard
            </a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 py-8">
      <!-- System Overview -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="glass-card rounded-xl p-6 service-card">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">System Health</h3>
            <div class="status-indicator status-online"></div>
          </div>
          <div class="text-3xl font-bold text-green-400 mb-2" id="systemHealth">
            98%
          </div>
          <p class="text-gray-400 text-sm">All services operational</p>
        </div>

        <div class="glass-card rounded-xl p-6 service-card">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">Active Agents</h3>
            <i class="fas fa-users text-blue-400"></i>
          </div>
          <div class="text-3xl font-bold text-blue-400 mb-2" id="activeAgents">
            12
          </div>
          <p class="text-gray-400 text-sm">Currently on duty</p>
        </div>

        <div class="glass-card rounded-xl p-6 service-card">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">Open Alerts</h3>
            <i class="fas fa-exclamation-triangle text-yellow-400"></i>
          </div>
          <div class="text-3xl font-bold text-yellow-400 mb-2" id="openAlerts">
            3
          </div>
          <p class="text-gray-400 text-sm">Require attention</p>
        </div>

        <div class="glass-card rounded-xl p-6 service-card">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">Response Time</h3>
            <i class="fas fa-clock text-purple-400"></i>
          </div>
          <div
            class="text-3xl font-bold text-purple-400 mb-2"
            id="responseTime"
          >
            2.3m
          </div>
          <p class="text-gray-400 text-sm">Average today</p>
        </div>
      </div>

      <!-- Services Status -->
      <div class="glass-card rounded-xl p-6 mb-8">
        <h2 class="text-xl font-bold mb-6">
          <i class="fas fa-server text-green-400 mr-3"></i>
          Service Status
        </h2>
        <div
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"
          id="servicesGrid"
        >
          <!-- Service status cards will be populated here -->
        </div>
      </div>

      <!-- Database Status -->
      <div class="glass-card rounded-xl p-6 mb-8">
        <h2 class="text-xl font-bold mb-6">
          <i class="fas fa-database text-blue-400 mr-3"></i>
          Database Status
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h3 class="text-lg font-semibold mb-4">Connection Status</h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <span>MongoDB Primary</span>
                <div class="flex items-center">
                  <div class="status-indicator status-online mr-2"></div>
                  <span class="text-green-400">Connected</span>
                </div>
              </div>
              <div class="flex items-center justify-between">
                <span>Connection Pool</span>
                <span class="text-blue-400" id="connectionPool">8/10</span>
              </div>
              <div class="flex items-center justify-between">
                <span>Query Response</span>
                <span class="text-green-400" id="queryResponse">12ms</span>
              </div>
            </div>
          </div>
          <div>
            <h3 class="text-lg font-semibold mb-4">Collection Stats</h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <span>Users</span>
                <span class="text-gray-300" id="userCount">1,247</span>
              </div>
              <div class="flex items-center justify-between">
                <span>Agents</span>
                <span class="text-gray-300" id="agentCount">52</span>
              </div>
              <div class="flex items-center justify-between">
                <span>SOS Alerts</span>
                <span class="text-gray-300" id="sosCount">8,934</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- API Endpoints -->
      <div class="glass-card rounded-xl p-6">
        <h2 class="text-xl font-bold mb-6">
          <i class="fas fa-plug text-purple-400 mr-3"></i>
          API Endpoints
        </h2>
        <div class="space-y-4" id="apiEndpoints">
          <!-- API status will be populated here -->
        </div>
      </div>
    </main>

    <script>
      // Service Management JavaScript
      class ServiceManager {
        constructor() {
          this.services = [
            {
              name: 'Authentication Service',
              endpoint: '/api/auth',
              status: 'online',
            },
            {
              name: 'Weather Service',
              endpoint: '/api/weather',
              status: 'online',
            },
            {
              name: 'SOS Alert Service',
              endpoint: '/api/sos',
              status: 'online',
            },
            {
              name: 'Agent Management',
              endpoint: '/api/agents',
              status: 'online',
            },
            {
              name: 'Communication Service',
              endpoint: '/api/communication',
              status: 'warning',
            },
            {
              name: 'Notification Service',
              endpoint: '/api/notifications',
              status: 'online',
            },
          ]

          this.apiEndpoints = [
            {
              method: 'GET',
              path: '/api/health',
              description: 'System health check',
            },
            {
              method: 'GET',
              path: '/api/weather/live',
              description: 'Live weather data',
            },
            {
              method: 'POST',
              path: '/api/sos/create',
              description: 'Create SOS alert',
            },
            {
              method: 'GET',
              path: '/api/agents/active',
              description: 'Get active agents',
            },
            {
              method: 'POST',
              path: '/api/auth/login',
              description: 'User authentication',
            },
          ]

          this.init()
        }

        init() {
          this.renderServices()
          this.renderApiEndpoints()
          this.startMonitoring()
          this.setupEventListeners()
        }

        renderServices() {
          const grid = document.getElementById('servicesGrid')
          grid.innerHTML = this.services
            .map(
              (service) => `
                    <div class="bg-slate-700/50 rounded-lg p-4 service-card">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-semibold">${service.name}</h4>
                            <div class="status-indicator status-${service.status}"></div>
                        </div>
                        <p class="text-gray-400 text-sm mb-2">${service.endpoint}</p>
                        <div class="flex items-center justify-between">
                            <span class="text-xs px-2 py-1 rounded-full ${this.getStatusColor(service.status)}">
                                ${service.status.toUpperCase()}
                            </span>
                            <button class="text-blue-400 hover:text-blue-300 text-sm" onclick="serviceManager.testService('${service.endpoint}')">
                                Test
                            </button>
                        </div>
                    </div>
                `
            )
            .join('')
        }

        renderApiEndpoints() {
          const container = document.getElementById('apiEndpoints')
          container.innerHTML = this.apiEndpoints
            .map(
              (endpoint) => `
                    <div class="bg-slate-700/50 rounded-lg p-4 flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <span class="px-2 py-1 text-xs font-mono rounded ${this.getMethodColor(endpoint.method)}">
                                ${endpoint.method}
                            </span>
                            <code class="text-gray-300">${endpoint.path}</code>
                            <span class="text-gray-400 text-sm">${endpoint.description}</span>
                        </div>
                        <button class="text-blue-400 hover:text-blue-300 text-sm" onclick="serviceManager.testEndpoint('${endpoint.path}')">
                            Test
                        </button>
                    </div>
                `
            )
            .join('')
        }

        getStatusColor(status) {
          switch (status) {
            case 'online':
              return 'bg-green-600 text-green-100'
            case 'offline':
              return 'bg-red-600 text-red-100'
            case 'warning':
              return 'bg-yellow-600 text-yellow-100'
            default:
              return 'bg-gray-600 text-gray-100'
          }
        }

        getMethodColor(method) {
          switch (method) {
            case 'GET':
              return 'bg-blue-600 text-blue-100'
            case 'POST':
              return 'bg-green-600 text-green-100'
            case 'PUT':
              return 'bg-yellow-600 text-yellow-100'
            case 'DELETE':
              return 'bg-red-600 text-red-100'
            default:
              return 'bg-gray-600 text-gray-100'
          }
        }

        async testService(endpoint) {
          try {
            const response = await fetch(endpoint)
            const status = response.ok ? 'online' : 'warning'
            this.updateServiceStatus(endpoint, status)
            console.log(`Service test ${endpoint}: ${response.status}`)
          } catch (error) {
            this.updateServiceStatus(endpoint, 'offline')
            console.error(`Service test ${endpoint} failed:`, error)
          }
        }

        async testEndpoint(path) {
          try {
            const response = await fetch(path)
            console.log(
              `Endpoint test ${path}: ${response.status}`,
              await response.text()
            )
          } catch (error) {
            console.error(`Endpoint test ${path} failed:`, error)
          }
        }

        updateServiceStatus(endpoint, status) {
          const service = this.services.find((s) => s.endpoint === endpoint)
          if (service) {
            service.status = status
            this.renderServices()
          }
        }

        startMonitoring() {
          // Update system stats periodically
          setInterval(() => {
            this.updateSystemStats()
          }, 5000)

          // Initial stats update
          this.updateSystemStats()
        }

        async updateSystemStats() {
          try {
            const response = await fetch('/api/admin/stats')
            const stats = await response.json()

            // Update UI elements with real data
            document.getElementById('activeAgents').textContent =
              stats.agents?.active || '0'
            document.getElementById('openAlerts').textContent =
              stats.alerts?.open || '0'
            document.getElementById('systemHealth').textContent =
              stats.system?.health || '0%'
          } catch (error) {
            console.error('Failed to update system stats:', error)
          }
        }

        setupEventListeners() {
          document
            .getElementById('refreshBtn')
            .addEventListener('click', () => {
              this.renderServices()
              this.renderApiEndpoints()
              this.updateSystemStats()
            })
        }
      }

      // Initialize service manager
      let serviceManager

      document.addEventListener('DOMContentLoaded', () => {
        serviceManager = new ServiceManager()
      })

      // Error handling
      window.addEventListener('error', (event) => {
        console.error('Service Management Error:', event.error)
      })
    </script>
  </body>
</html>
